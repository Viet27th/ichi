{"version":3,"file":"static/webpack/static/development/pages/login.js.c143c4fdeab59b2bf55e.hot-update.js","sources":["webpack:///./scenes/login/index.js","webpack:///./services/axios.service.js"],"sourcesContent":["import React from 'react';\nimport style from './style.css';\nimport Link from 'next/link';\nimport Router from 'next/router';\nimport {axiosInstance} from '../../services/axios.service';\nimport {regexEmail} from '../../services/regex.service';\nimport {AlertComponentEvolution} from '../../components/alert';\nimport {SpinnerComponentEvolution} from '../../components/spinner';\nimport cookie from '../../services/cookie.service';\nimport middleware from '../../middleware';\nimport {express_api} from '../../services/express_api.service';\n\nclass LoginScene extends React.Component {\n  static async getInitialProps(ctx) {\n    let { query } = ctx;\n    // If user logged in successfully, can't visit login page. Auto redirect to root url.\n    if(!middleware.redirectIfNotAuthenticated(ctx)) {\n      if(ctx.res) {\n        ctx.res.writeHead(303, {Location: '/'});\n        ctx.res.end();\n      } else {\n        Router.push('/');\n      }\n    }\n    \n    return { query };\n  }\n  \n  constructor(props) {\n    super(props);\n    this.state = {\n      email: '',\n      password: ''\n    };\n  }\n  \n  render() {\n    return (\n      <div id='wrapped-login'>\n        <div id='login' >\n          <h2>Login</h2>\n          <input name='email' placeholder='Email' type='text'\n            value={this.state.email}\n            onChange={this.handleChange}\n          />\n          <input name='password' placeholder='Password' type='password'\n            value={this.state.password}\n            onChange={this.handleChange}\n          />\n          \n          <div className='social pt-5 pb-3 d-flex justify-content-center align-items-center'>\n            <span className='twitter cursor-pointer'>\n              <i className=\"fab fa-twitter\"></i>\n            </span>\n            <span className='facebook cursor-pointer'>\n              <i className=\"fab fa-facebook-f\"></i>\n            </span>\n            <span className='google-plus cursor-pointer'>\n              <i className=\"fab fa-google-plus-g\"></i>\n            </span>\n            <span className='youtube cursor-pointer'>\n              <i className=\"fab fa-github\"></i>\n            </span>\n          </div>\n          \n          <input type='submit' value='Login' onClick={this.handleSubmit}/>\n          <Link href='/register'><a className='forgot'>Don't have an account?</a></Link>\n        </div>\n       \n        <style jsx>{style}</style>\n      </div>\n    );\n  };\n  \n  /**\n   * Refer: https://medium.freecodecamp.org/what-i-wish-i-knew-when-i-started-to-work-with-react-js-3ba36107fd13\n   * @param e\n   */\n  handleChange = e => {\n    let {target} = e;\n    this.setState({\n      [target.name]: target.value\n    });\n  };\n  \n  handleSubmit = () => {\n    if (!regexEmail(this.state.email) || this.state.email.trim() === '') {\n      AlertComponentEvolution.show('Email không chính xác.');\n    } else if (this.state.password.trim() === '') {\n      AlertComponentEvolution.show('Password không được để trống.');\n    } else {\n      SpinnerComponentEvolution.show();\n      axiosInstance().post(express_api.webLoginTraditionalUrl, {\n        email: this.state.email,\n        password: this.state.password\n      }, {\n        handlerEnabled: false\n      }).then(result => {\n        SpinnerComponentEvolution.hide();\n        if (result.data.requestSuccessfully) {\n       \n          // Set cookie client\n          cookie.clientSetCookie('token',result.data.data.token, result.data.data.expMillisecond);\n          \n          // After logged in successfully, redirect to previous url\n          if(this.props.query.previousUrl) {\n            Router.push(this.props.query.previousUrl);\n          } else {\n            Router.push('/');\n          }\n        } else {\n          AlertComponentEvolution.show(result.data.message);\n        }\n      }).catch(error => {\n        SpinnerComponentEvolution.hide();\n        console.log(error);\n      });\n    }\n  };\n  \n}\n\nexport default LoginScene;\n","import axios from 'axios';\nimport cookie from './cookie.service';\nimport {AlertComponentEvolution} from '../components/alert';\nimport {LoginComponentEvolution} from '../components/login';\nimport Router from 'next/router';\nimport {express_api} from './express_api.service';\n\n/**\n *\n * @param req - if request come from Nextjs server, we've merely pass this params\n * @returns {AxiosInstance}\n */\nexport const axiosInstance = function (req) {\n  let token;\n  if (req) {\n    token = cookie.serverGetCookieByName(req, 'token');\n  } else {\n    token = cookie.clientGetCookieByName('token');\n  }\n  \n  let axiosInstance = axios.create({\n    timeout: 9000\n  });\n  axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n  \n  /**\n   * Add a request interceptor to verify before send request\n   * Request never sent if token is invalid\n   */\n  axiosInstance.interceptors.request.use(function (config) {\n    // Hàm này được gọi trước khi request được gửi đi.\n    // Do something before request is sent, if it's ok, you must be return \"config\" otherwise request never be sent\n    \n    let userProfile = cookie.verifyJWT(token);\n    \n    // Gọi mội refresh token nếu token của user sắp hết hạn.\n    // Hành động này config ở 2 nơi:\n    // 1: Xảy ra khi gọi request\n    // 2: Xảy ra khi chuyển trang, đã config trong _app.js\n    // Token is expired in 8 days, before that 7 day, we will refresh token if user still working on my system.\n    // If user doesn't on my system in 7 days, next time visiting must be login\n    if (userProfile && typeof window !== 'undefined') {\n      if ((userProfile.expMillisecond - Date.now()) < 7 * 24 * 60 * 60 * 1000) {\n        axios.post(express_api.webRefreshTokenTraditionalUrl, {}, {\n          headers: {'Authorization': `Bearer ${token}`},\n        }).then(result => {\n          // Set cookie client\n          cookie.clientSetCookie('token', result.data.data.token, result.data.data.expMillisecond);\n        }).catch(error => {\n          console.log(error.message);\n        });\n      }\n    }\n    \n    //\n    // Thường thì khi gửi request sẽ cần login => noNeedLogin = false or undefined.\n    if (!userProfile && config.url !== express_api.webLoginTraditionalUrl) {\n      // Ném ra 1 lỗi và sẽ được bắt ở catch khi gửi request. Giống như việc request trả về status khác 200.\n      // Catch trong mỗi request sẽ chạy khi status response khác 200,\n      // hoặc then ném ra 1 lỗi, hoặc ở đây (trước khi request) ném ra 1 lỗi\n      // throw new Error('token error');\n      LoginComponentEvolution.show();\n      return;\n    }\n    \n    return config;\n  }, function (error) {\n    // Không biết hàm này trigger khi nào\n    // Do something with request error\n    console.log('axios handle request error: ', error);\n    return Promise.reject(error);\n  });\n  \n  // Add a response interceptor\n  axiosInstance.interceptors.response.use(function (response) {\n    // Hàm này chạy khi có response trả về với status = 200, hàm này chạy trước rồi đến then.\n    // Do something with response data\n    return response;\n  }, function (error) {\n    // Hàm này được gọi khi request trả về status khác 200 tức là response lỗi.\n    // Sau khi hàm này chạy, catch mới chạy. Catch cũng bắt lỗi với các response có status khác 200.\n    // Do something with response error\n    return Promise.reject(error);\n  });\n  \n  return axiosInstance;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AACA;;;;;;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAkDA;AACA;AACA;AAGA;AACA;AAxDA;AA0DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AADA;AAGA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzFA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA5BA;AAAA;AAAA;AAkCA;;;;AA5DA;AACA;AA6GA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAEA;;;;;AAIA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;A","sourceRoot":""}